{% extends 'base.html' %}
{% load static %}

{% block title %}{{ product.name }} - Fiare din Beci{% endblock %}

{% block content %}
<!-- Product Section with new, modern layout -->
<section class="content-section">
    <div class="container px-4 px-lg-5 my-5">
        <div class="row gx-4 gx-lg-5 align-items-center">

            <!-- Product Image Slideshow -->
            <div class="col-md-7">
                <div class="main-image-container mb-3">
                    <img class="img-fluid rounded" id="mainProductImage" src="{% if product.cover_image %}{{ product.cover_image.url }}{% elif product.images.all.0 %}{{ product.images.all.0.image.url }}{% else %}https://placehold.co/700x800/212529/FFF?text=Imagine{% endif %}" alt="{{ product.name }}">
                    <!-- Removed onclick attributes -->
                    <button class="prev-btn"><i class="fas fa-chevron-left"></i></button>
                    <button class="next-btn"><i class="fas fa-chevron-right"></i></button>
                </div>
                <!-- Thumbnail Gallery -->
                <div class="thumbnail-container mt-3">
                    <!-- Thumbnails will be generated by JavaScript -->
                </div>
            </div>

            <!-- Product Details & Actions -->
            <div class="col-md-5">
                <div class="product-info-wrapper">
                    <h1 class="display-5 fw-bolder product-title">{{ product.name }}</h1>

                    <div class="fs-4 mb-3 product-price">
                        <span>{{ product.price }} RON</span>
                    </div>

                    <p class="lead product-description mb-5">{{ product.description|truncatewords:35 }}</p>

                    <div class="d-flex mb-5">
                        <input class="form-control text-center me-3" id="inputQuantity" type="number" value="1" min="1" style="max-width: 5rem" />
                        <button class="btn btn-dark btn-lg flex-shrink-0" type="button">
                            <i class="fas fa-shopping-cart me-2"></i>
                            Adaugă în coș
                        </button>
                    </div>

                    <hr class="my-4">

                    <h6 class="spec-title mb-3">Caracteristici Cheie:</h6>
                    <ul class="list-unstyled text-muted">
                        <li class="mb-2"><i class="fas fa-shield-alt fa-fw me-2"></i>Forjat manual din oțel carbon.</li>
                        <li class="mb-2"><i class="fas fa-balance-scale-right fa-fw me-2"></i>Echilibru și manevrabilitate perfectă.</li>
                        <li class="mb-2"><i class="fas fa-feather-alt fa-fw me-2"></i>Design autentic, inspirat istoric.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Additional Info Section -->
<section class="py-5 bg-light">
    <div class="container px-4 px-lg-5">
        <div class="row gx-4 gx-lg-5 justify-content-center">
            <div class="col-lg-10">
                <h3 class="text-dark text-center mb-5">Forjat cu Respect Pentru Istorie</h3>
                <div class="row">
                    <div class="col-md-6 mb-4">
                        <img class="img-fluid rounded" src="https://placehold.co/600x400/212529/FFF?text=Atelier" alt="Atelier">
                        <h5 class="fw-bolder mt-3">Măiestrie</h5>
                        <p class="text-muted">Fiecare piesă este unică, creată cu unelte și tehnici tradiționale în atelierul nostru.</p>
                    </div>
                    <div class="col-md-6 mb-4">
                        <img class="img-fluid rounded" src="https://placehold.co/600x400/212529/FFF?text=Detaliu" alt="Detaliu">
                        <h5 class="fw-bolder mt-3">Atenție la Detaliu</h5>
                        <p class="text-muted">De la echilibrul lamei la detaliile de pe gardă, fiecare element este executat cu precizie.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_scripts %}
<style>
    /* Add a professional serif font for the title */
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&display=swap');

    /* Override page background for this page only */
    body {
        background-color: #f8f9fa !important;
    }
    .product-title {
        font-family: 'Playfair Display', serif;
        color: #212529 !important;
    }
    .product-price {
        color: #212529 !important;
        font-weight: 600;
    }
    .product-description, .spec-title, .spec-text, h3.text-dark, .text-muted {
        color: #6c757d !important;
    }
    .spec-title {
        font-weight: 700;
        text-transform: uppercase;
        font-size: 0.8rem;
        color: #212529 !important;
    }
    .btn-dark {
        background-color: #212529;
        border-color: #212529;
    }
    .btn-dark:hover {
        background-color: #343a40;
        border-color: #343a40;
    }

    /* Slideshow styles */
    .main-image-container {
        position: relative;
        width: 100%;
        aspect-ratio: 1 / 1;
        overflow: hidden;
    }
    #mainProductImage {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: opacity 0.3s ease-in-out;
    }
    .prev-btn, .next-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background-color: transparent;
        color: #fff;
        border: 2px solid #fff;
        width: 3rem;
        height: 3rem;
        border-radius: 50%;
        display: none;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
        opacity: 0;
        z-index: 2; /* Ensure buttons are above thumbnails */
    }
    .main-image-container:hover .prev-btn,
    .main-image-container:hover .next-btn {
        opacity: 0.8;
    }
    .prev-btn:hover, .next-btn:hover {
        background-color: rgba(255, 255, 255, 0.1);
        opacity: 1;
    }
    .prev-btn { left: 1rem; }
    .next-btn { right: 1rem; }

    /* Thumbnail Styles */
    .thumbnail-container {
        display: flex;
        justify-content: center;
        gap: 0.5rem;
        margin-top: 1rem;
    }
    .thumbnail-image {
        width: 80px;
        height: 80px;
        object-fit: cover;
        cursor: pointer;
        border-radius: 0.25rem;
        border: 2px solid transparent;
        transition: border-color 0.2s ease-in-out;
    }
    .thumbnail-image.active {
        border-color: #64a19d;
    }
</style>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const imageUrls = JSON.parse('{{ image_urls_json|safe|default:"[]" }}');

        if (imageUrls.length === 0) {
            console.log("No images found for this product.");
            return; // Exit if there are no images
        }

        let currentImageIndex = 0;
        const mainImage = document.getElementById('mainProductImage');
        const prevButton = document.querySelector('.prev-btn');
        const nextButton = document.querySelector('.next-btn');
        const thumbnailContainer = document.querySelector('.thumbnail-container');

        // Function to create and display thumbnails
        function setupThumbnails() {
            thumbnailContainer.innerHTML = '';
            imageUrls.forEach((url, index) => {
                const img = document.createElement('img');
                img.src = url;
                img.classList.add('thumbnail-image');
                img.onclick = () => showImage(index);
                thumbnailContainer.appendChild(img);
            });
        }

        // Function to show a specific image and update active thumbnail
        function showImage(index) {
            currentImageIndex = index;
            mainImage.style.opacity = 0;
            setTimeout(() => {
                mainImage.src = imageUrls[currentImageIndex];
                mainImage.style.opacity = 1;
            }, 300);

            const thumbnails = thumbnailContainer.querySelectorAll('.thumbnail-image');
            thumbnails.forEach((thumb, i) => {
                thumb.classList.toggle('active', i === currentImageIndex);
            });
        }

        // Attach event listeners directly to the buttons
        prevButton.addEventListener('click', () => {
            let newIndex = currentImageIndex - 1;
            if (newIndex < 0) {
                newIndex = imageUrls.length - 1;
            }
            showImage(newIndex);
        });

        nextButton.addEventListener('click', () => {
            let newIndex = currentImageIndex + 1;
            if (newIndex >= imageUrls.length) {
                newIndex = 0;
            }
            showImage(newIndex);
        });

        // Initial setup
        setupThumbnails();
        showImage(0);

        if (imageUrls.length > 1) {
            prevButton.style.display = 'flex';
            nextButton.style.display = 'flex';
        }
    });
</script>
{% endblock %}
